// Copyright 2022 Markus Knutsson (@TweetyDaBird)
// SPDX-License-Identifier: GPL-2.0-or-later
#include <stdint.h>
#include <sys/types.h>
#include "config.h"
#include QMK_KEYBOARD_H

const uint16_t PROGMEM keymaps[][MATRIX_ROWS][MATRIX_COLS] = {
// base layer
    [0] = LAYOUT(
                KC_GRV,   KC_1,   KC_2,    KC_3,    KC_4,          KC_5,         KC_MPLY,              KC_MPLY,          KC_6,            KC_7,    KC_8,   KC_9,    KC_0,         KC_MINS,
                KC_TAB,   KC_Q,   KC_W,    KC_F,    KC_P,          KC_B,                                                 KC_J,            KC_L,    KC_U,   KC_Y, KC_SCLN,         KC_BSLS,
        LCTL_T(KC_ESC),   KC_A,   KC_R,    KC_S,    KC_T,          KC_G,                                                 KC_K,            KC_N,    KC_E,   KC_I,    KC_O, RCTL_T(KC_QUOT),
               KC_LGUI,   KC_Z,   KC_X,    KC_C,    KC_D,          KC_V,      SGUI(KC_A),              KC_CAPS,          KC_M,            KC_H, KC_COMM, KC_DOT, KC_SLSH,          KC_EQL,
                                          TG(3), KC_LALT,  LT(6,KC_DEL), LSFT_T(KC_BSPC),       KC_SPC,  LT(5,KC_ENT), KC_RALT,   MO(4)
    ),

// gaming layer
    [1] = LAYOUT(
         KC_ESC,   KC_1,   KC_2,   KC_3,    KC_4,   KC_5,    KC_TRNS,       KC_TRNS,    KC_6,    KC_7,         KC_8,    KC_9,    KC_0,   TG(2),
         KC_TAB,   KC_Q,   KC_W,   KC_E,    KC_R,   KC_T,                               KC_Y,    KC_U,         KC_I,    KC_O,    KC_P,  KC_ENT,
        KC_LSFT,   KC_A,   KC_S,   KC_D,    KC_F,   KC_G,                               KC_H,    KC_J,         KC_K,    KC_L, KC_SCLN, KC_RSFT,
        KC_LCTL,   KC_Z,   KC_X,   KC_C,    KC_V,   KC_B, SGUI(KC_A),       KC_CAPS,    KC_N,    KC_M,      KC_COMM,  KC_DOT, KC_SLSH, KC_RCTL,
                                KC_LGUI, KC_LALT, KC_ENT,     KC_SPC,       KC_BSPC,  KC_DEL, KC_RALT, LALT(KC_TAB)
    ),

// settings layer
    [2] = LAYOUT(
        QK_BOOT, XXXXXXX, XXXXXXX, XXXXXXX, NK_TOGG, XXXXXXX, KC_TRNS,      KC_TRNS, XXXXXXX,  XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX,   TG(2),
         QK_RBT, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX,                        XXXXXXX,  XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX,
        DB_TOGG, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX,                        XXXXXXX,  XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX,
        XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX,      XXXXXXX, XXXXXXX,  XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX,
                                   XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX,      XXXXXXX, XXXXXXX,  XXXXXXX, XXXXXXX
    ),

// mouse layer
    [3] = LAYOUT(
        XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX, KC_TRNS,        KC_TRNS, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX,
        XXXXXXX, XXXXXXX, XXXXXXX, KC_MS_U, XXXXXXX, XXXXXXX,                          XXXXXXX, XXXXXXX, KC_WH_U, XXXXXXX, XXXXXXX, XXXXXXX,
        XXXXXXX, XXXXXXX, KC_MS_L, KC_MS_D, KC_MS_R, XXXXXXX,                          XXXXXXX, KC_WH_L, KC_WH_D, KC_WH_R, XXXXXXX, XXXXXXX,
        XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX,        XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX,
                                     TG(3), XXXXXXX, XXXXXXX, KC_BTN1,        KC_BTN2, XXXXXXX, XXXXXXX, MO(4)
    ),

// fn layer
    [4] = LAYOUT(
               XXXXXXX, XXXXXXX,       XXXXXXX,       XXXXXXX,         XXXXXXX,      XXXXXXX,         KC_MUTE,               KC_TRNS,      XXXXXXX,          KC_F10,  KC_F11,  KC_F12, XXXXXXX,         XXXXXXX,
                KC_TAB, XXXXXXX, LSFT(KC_PGUP),   LSFT(KC_UP),    LSFT(KC_END),      XXXXXXX,                                              XXXXXXX,           KC_F7,   KC_F8,   KC_F9, XXXXXXX,         XXXXXXX,
        LCTL_T(KC_ESC), KC_WBAK, LSFT(KC_LEFT), LSFT(KC_DOWN),  LSFT(KC_RIGHT),      KC_WFWD,                                              XXXXXXX,           KC_F4,   KC_F5,   KC_F6, XXXXXXX, RCTL_T(KC_QUOT),
               KC_LGUI, KC_BRID, LSFT(KC_HOME),       KC_PSCR,   LSFT(KC_PGDN),      KC_BRIU,      SGUI(KC_A),               KC_CAPS,      XXXXXXX,           KC_F1,   KC_F2,   KC_F3, XXXXXXX,         XXXXXXX,
                                                        TG(3),         KC_LALT, LT(6,KC_DEL), LSFT_T(KC_BSPC),        KC_SPC, LT(5,KC_ENT), KC_RALT,  MO(4)
    ),

//symbol layer
    [5] = LAYOUT(
        XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX, KC_TRNS,          KC_TRNS, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX,
        KC_TRNS, KC_EXLM,   KC_AT, KC_HASH,  KC_DLR, KC_PERC,                            KC_CIRC, KC_AMPR, KC_ASTR, XXXXXXX,  KC_UNDS, KC_EQL,
        KC_TRNS, KC_PMNS, KC_LBRC, KC_LCBR, KC_LPRN,   KC_LT,                              KC_GT, KC_RPRN, KC_RCBR, KC_RBRC, KC_PPLS, KC_TRNS,
        KC_TRNS, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX, KC_TRNS,          KC_TRNS, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX,
                                   KC_TRNS, KC_TRNS, KC_TRNS, KC_TRNS,          KC_TRNS, KC_TRNS, KC_TRNS, KC_TRNS
    ),

// numpad / arrow layer
    [6] = LAYOUT(
        XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX,  XXXXXXX, XXXXXXX, KC_TRNS,         KC_TRNS, XXXXXXX,  KC_NUM, KC_PSLS, KC_PAST, XXXXXXX, XXXXXXX,
        KC_TRNS, XXXXXXX, KC_PGUP,   KC_UP,   KC_END, XXXXXXX,                           XXXXXXX,   KC_P7,   KC_P8,   KC_P9, KC_PMNS, XXXXXXX,
        KC_TRNS, XXXXXXX, KC_LEFT, KC_DOWN, KC_RIGHT, XXXXXXX,                           KC_PDOT,   KC_P4,   KC_P5,   KC_P6, KC_PPLS, KC_TRNS,
        KC_TRNS, XXXXXXX, KC_HOME,  KC_APP,  KC_PGDN, XXXXXXX, KC_TRNS,         KC_TRNS,   KC_P0,   KC_P1,   KC_P2,   KC_P3, XXXXXXX, XXXXXXX,
                                   KC_TRNS,  KC_TRNS, KC_TRNS, KC_TRNS,         KC_TRNS, KC_TRNS, KC_TRNS, KC_TRNS
    )
};

const uint16_t PROGMEM COMBO_TG1[] = {SGUI(KC_A), KC_CAPS, COMBO_END};
const uint16_t PROGMEM COMBO_CAPS_WORD_TOGG[] = {LSFT_T(KC_BSPC), KC_SPC, COMBO_END};
const uint16_t PROGMEM COMBO_NUM_LAYER[] = {TG(3), MO(4), COMBO_END};

combo_t key_combos[] = {
    COMBO(COMBO_CAPS_WORD_TOGG, CW_TOGG),
    COMBO(COMBO_TG1, TG(1)),
    COMBO(COMBO_NUM_LAYER, TG(6)),
};

#if defined(ENCODER_MAP_ENABLE)
const uint16_t PROGMEM encoder_map[][NUM_ENCODERS][NUM_DIRECTIONS] = {
    [0] = { ENCODER_CCW_CW(KC_VOLD, KC_VOLU), ENCODER_CCW_CW(KC_VOLD, KC_VOLU) },
    [1] = { ENCODER_CCW_CW(KC_TRNS, KC_TRNS), ENCODER_CCW_CW(KC_TRNS, KC_TRNS) },
    [2] = { ENCODER_CCW_CW(KC_TRNS, KC_TRNS), ENCODER_CCW_CW(KC_TRNS, KC_TRNS) },
    [3] = { ENCODER_CCW_CW(KC_TRNS, KC_TRNS), ENCODER_CCW_CW(KC_TRNS, KC_TRNS) },
    [4] = { ENCODER_CCW_CW(KC_LEFT, KC_RIGHT), ENCODER_CCW_CW(KC_LEFT, KC_RIGHT) },
    [5] = { ENCODER_CCW_CW(KC_VOLD, KC_VOLU), ENCODER_CCW_CW(KC_VOLD, KC_VOLU) },
    [6] = { ENCODER_CCW_CW(KC_VOLD, KC_VOLU), ENCODER_CCW_CW(KC_VOLD, KC_VOLU) },
};
#endif

#ifdef OLED_ENABLE
static void print_status_narrow(void) {
    static const char BASE_LAYER [] PROGMEM = {
        0xe0, 0xf8, 0x0c, 0x06, 0x02, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03,
        0x03, 0x83, 0x83, 0x83, 0x83, 0x43, 0x43, 0x63, 0x23, 0x23, 0xe3, 0x02, 0x06, 0x0c, 0xf8, 0xe0,
        0xff, 0xff, 0x18, 0x3c, 0x46, 0x02, 0xc2, 0x62, 0x32, 0x18, 0x0c, 0xd4, 0x66, 0x22, 0x92, 0x9f,
        0x89, 0xcd, 0x66, 0x22, 0x1a, 0x1a, 0x09, 0x0d, 0x06, 0x03, 0x01, 0x00, 0x02, 0x02, 0xff, 0xff,
        0xff, 0xff, 0x00, 0x00, 0x00, 0xc7, 0xff, 0xf0, 0x2c, 0x26, 0x21, 0x20, 0x30, 0x18, 0x0c, 0x27,
        0x61, 0x60, 0x40, 0x40, 0x40, 0x80, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff,
        0x07, 0x1f, 0x30, 0x60, 0x4f, 0xcf, 0xc3, 0xc8, 0xc8, 0xc8, 0xc8, 0xd8, 0xd0, 0xd0, 0xd0, 0xd0,
        0xd0, 0xd0, 0xd8, 0xc8, 0xc8, 0xcc, 0xc7, 0xc3, 0xc0, 0xc0, 0xc0, 0x40, 0x60, 0x30, 0x1f, 0x07
    };
    static const char MOUSE_LAYER [] PROGMEM = {
        0xe0, 0xf8, 0x0c, 0x06, 0x02, 0x03, 0x03, 0x03, 0xc3, 0x63, 0x33, 0x13, 0x13, 0x13, 0x93, 0x73,
        0x73, 0x93, 0x13, 0x13, 0x13, 0x33, 0x63, 0xc3, 0x03, 0x03, 0x03, 0x02, 0x06, 0x0c, 0xf8, 0xe0,
        0xff, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0x40, 0x40, 0x40, 0x40, 0x40, 0x5f, 0x60,
        0x60, 0x5f, 0x40, 0x40, 0x40, 0x40, 0x40, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff,
        0xff, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff,
        0x07, 0x1f, 0x30, 0x60, 0x40, 0xc0, 0xc0, 0xc0, 0xc0, 0xc3, 0xc6, 0xc4, 0xcc, 0xc8, 0xc8, 0xc8,
        0xc8, 0xc8, 0xc8, 0xcc, 0xc4, 0xc6, 0xc3, 0xc0, 0xc0, 0xc0, 0xc0, 0x40, 0x60, 0x30, 0x1f, 0x07
    };
    static const char FN_LAYER [] PROGMEM = {
        0xe0, 0xf8, 0x0c, 0x86, 0x82, 0x83, 0x83, 0x83, 0x83, 0x83, 0x83, 0x83, 0x83, 0x83, 0x83, 0x03,
        0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x02, 0x06, 0x0c, 0xf8, 0xe0,
        0xff, 0xff, 0x00, 0xff, 0xff, 0xff, 0x83, 0x83, 0x83, 0x83, 0x83, 0x83, 0x83, 0x03, 0x03, 0x00,
        0x00, 0x00, 0xf0, 0xf0, 0xc0, 0xc0, 0x60, 0x30, 0x30, 0x70, 0xf0, 0xe0, 0xc0, 0x00, 0xff, 0xff,
        0xff, 0xff, 0x00, 0xff, 0xff, 0xff, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x00, 0x00, 0x00,
        0x00, 0x00, 0xff, 0xff, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0x00, 0xff, 0xff,
        0x07, 0x1f, 0x30, 0x61, 0x41, 0xc1, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0,
        0xc0, 0xc0, 0xc1, 0xc1, 0xc1, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc1, 0x41, 0x61, 0x30, 0x1f, 0x07
    };
    static const char SYMBOL_LAYER [] PROGMEM = {
        0xe0, 0xf8, 0x0c, 0x06, 0x82, 0x83, 0x83, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03,
        0x03, 0x03, 0x83, 0xc3, 0xc3, 0xc3, 0xc3, 0x83, 0x03, 0x03, 0x03, 0x02, 0x06, 0x0c, 0xf8, 0xe0,
        0xff, 0xff, 0x00, 0x00, 0xff, 0xff, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3c,
        0x7e, 0xff, 0xc7, 0x83, 0x01, 0x01, 0x03, 0x07, 0x07, 0x06, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff,
        0xff, 0xff, 0x00, 0xc0, 0xe7, 0xe7, 0xe7, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x38, 0x7c, 0xfe,
        0xc7, 0x83, 0x83, 0x87, 0xcf, 0xfe, 0xfc, 0x78, 0xfc, 0xfe, 0xce, 0x86, 0x00, 0x00, 0xff, 0xff,
        0x07, 0x1f, 0x30, 0x61, 0x43, 0xc3, 0xc3, 0xc1, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0,
        0xc1, 0xc3, 0xc3, 0xc3, 0xc3, 0xc1, 0xc0, 0xc0, 0xc0, 0xc1, 0xc1, 0x41, 0x61, 0x30, 0x1f, 0x07
    };
    static const char NUM_LAYER [] PROGMEM = {
        0xe0, 0xf8, 0x0c, 0x06, 0x82, 0x03, 0x03, 0x83, 0x83, 0x03, 0x03, 0x03, 0x83, 0x83, 0x03, 0x03,
        0x03, 0x83, 0x83, 0x03, 0x03, 0x83, 0x03, 0x03, 0x83, 0x83, 0x03, 0x02, 0x86, 0x0c, 0xf8, 0xe0,
        0xff, 0xff, 0x00, 0x00, 0x1f, 0x00, 0x0f, 0x10, 0x10, 0x0f, 0x00, 0x0f, 0x10, 0x10, 0x0f, 0x80,
        0x8f, 0x10, 0x10, 0x0f, 0x00, 0x1f, 0x00, 0x0f, 0x10, 0x10, 0x0f, 0x00, 0x1f, 0x00, 0xff, 0xff,
        0xff, 0xff, 0x00, 0x00, 0x00, 0x00, 0x80, 0xc0, 0xe0, 0x80, 0x80, 0x80, 0x00, 0x02, 0x03, 0xdf,
        0xdf, 0x03, 0x02, 0x00, 0x80, 0x80, 0x80, 0xe0, 0xc0, 0x80, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff,
        0x07, 0x1f, 0x30, 0x60, 0x40, 0xc0, 0xc1, 0xc3, 0xc7, 0xc1, 0xc1, 0xc1, 0xc0, 0xc2, 0xc6, 0xcf,
        0xcf, 0xc6, 0xc2, 0xc0, 0xc1, 0xc1, 0xc1, 0xc7, 0xc3, 0xc1, 0xc0, 0x40, 0x60, 0x30, 0x1f, 0x07
    };
    static const char CAPS_ON [] PROGMEM = {
        0x00, 0x00, 0xf8, 0xfc, 0x7c, 0x3c, 0xdc, 0xdc, 0xdc, 0x9c, 0xfc, 0xfc, 0x1c, 0x9c, 0x7c, 0xfc,
        0xfc, 0x1c, 0xdc, 0xdc, 0x9c, 0x3c, 0xfc, 0x3c, 0x9c, 0xdc, 0x9c, 0xfc, 0xfc, 0xf8, 0x00, 0x00,
        0x00, 0x00, 0x7f, 0xff, 0xf8, 0xf0, 0xef, 0xef, 0xef, 0xef, 0xe7, 0xf0, 0xfa, 0xfb, 0xf0, 0xe3,
        0xff, 0xe0, 0xfb, 0xfb, 0xf9, 0xfc, 0xff, 0xe6, 0xee, 0xec, 0xe1, 0xf3, 0xff, 0x7f, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
    };
    static const char CAPS_OFF [] PROGMEM = {
        0xf0, 0xfc, 0x06, 0x02, 0x83, 0xc3, 0x23, 0x23, 0x23, 0x63, 0x03, 0x03, 0xe3, 0x63, 0x83, 0x03,
        0x03, 0xe3, 0x23, 0x23, 0x63, 0xc3, 0x03, 0xc3, 0x63, 0x23, 0x63, 0x03, 0x02, 0x06, 0xfc, 0xf0,
        0x3f, 0xff, 0x80, 0x00, 0x07, 0x0f, 0x10, 0x10, 0x10, 0x10, 0x18, 0x0f, 0x05, 0x04, 0x0f, 0x1c,
        0x00, 0x1f, 0x04, 0x04, 0x06, 0x03, 0x00, 0x19, 0x11, 0x13, 0x1e, 0x0c, 0x00, 0x80, 0xff, 0x3f,
        0x00, 0x00, 0x01, 0x01, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03,
        0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x01, 0x01, 0x00, 0x00
    };

    // Print current layer
    switch (get_highest_layer(layer_state)) {
        case 0:
            oled_write_raw_P(BASE_LAYER, sizeof(BASE_LAYER));
            break;
        case 1:
            oled_clear();
            oled_write_P(PSTR("QWERT\n"), false);
            break;
        case 2:
            oled_clear();
            oled_write_P(PSTR("-Sys \n"), false);
            break;
        case 3:
            oled_write_raw_P(MOUSE_LAYER, sizeof(MOUSE_LAYER));
            break;
        case 4:
            oled_write_raw_P(FN_LAYER, sizeof(FN_LAYER));
            break;
        case 5:
            oled_write_raw_P(SYMBOL_LAYER, sizeof(SYMBOL_LAYER));
            break;
        case 6:
            oled_write_raw_P(NUM_LAYER, sizeof(NUM_LAYER));
            break;
        default:
            oled_write_P(PSTR("Undef\n"), false);
    }

    oled_set_cursor(0, 5);
    bool caps = host_keyboard_led_state().caps_lock;
    oled_write_raw_P(caps ? CAPS_ON : CAPS_OFF, sizeof(CAPS_ON));

    oled_set_cursor(1, 8);
    oled_write_ln_P(get_u8_str(get_current_wpm(), '0'), false);
    oled_write_P(PSTR(" WPM "), false);
    // oled_write_raw_P(SOUND_ON_MIC_ON, sizeof(SOUND_ON_MIC_ON));
}

bool oled_task_user(void) {
    // Render the OLED
    print_status_narrow();
    return false;
}

#endif
